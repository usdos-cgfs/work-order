<script>
  function speak() {
    console.log("outer function");
  }
  var Foo = function (bar) {
    let self = this;
    self.bar = bar;
    function speak() {
      let ret = self.bar;
      self.reset();
      console.log(ret);
    }
    function pingInner() {
      echoInner();
    }
    function echo(val) {
      self.bar = val;
      function echoInner() {
        console.log("inner ", self.bar);
      }
      let echoInner2 = () => {
        console.log("inner2 ", self.bar);
      };
      echoInner();
      echoInner2();
      this.peter = "peter";
    }
    self.reset = function () {
      console.log("resetting");
      self.bar = "bye";
      var baz = "huh";
      this.peter2 = "peter2";
    };
    function getPeters() {
      console.log(this.peter);
      console.log(this.peter2);
    }
    return { speak, echo, pingInner, getPeters };
  };

  let test = new Foo("testing");

  let test2 = new Foo("testing2");

  test.speak();

  test.speak();

  test.echo("hi");

  test.getPeters();
</script>
