<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
  crossorigin="anonymous"
/>

<link rel="stylesheet" href="../SiteAssets/wo/app.css" />
<link
  rel="stylesheet"
  href="../SiteAssets/workorder/vendor/fontawesome-5.9.0/css/all.min.css"
/>

<div id="app">
  <ul class="nav nav-tabs" id="section-tabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="my-requests-tab"
        data-bs-toggle="tab"
        data-bs-target="#my-requests"
        data-bind="click: TabClicked"
        type="button"
        role="tab"
        aria-controls="my-requests"
        aria-selected="true"
      >
        My Orders
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="new-request-tab"
        data-bs-toggle="tab"
        data-bs-target="#new-request"
        data-bind="click: TabClicked"
        type="button"
        role="tab"
        aria-controls="new-request"
        aria-selected="true"
      >
        New Order
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="request-detail-tab"
        data-bs-toggle="tab"
        data-bs-target="#request-detail"
        data-bind="click: TabClicked"
        type="button"
        role="tab"
        aria-controls="request-detail"
        aria-selected="false"
      >
        Detail View
      </button>
    </li>
  </ul>
  <div class="tab-content">
    <div
      class="tab-pane"
      role="tabpanel"
      aria-labelledby="my-requests-tab"
      id="my-requests"
    >
      <div
        data-bind="template: {name: 'tmpl-my-requests-view', data: MyRequestsView}"
      ></div>
    </div>
    <div
      class="tab-pane"
      role="tabpanel"
      aria-labelledby="new-request"
      id="new-request"
    >
      <div
        data-bind="template: {name: 'tmpl-new-request-view', data: NewRequestView}"
      ></div>
    </div>
    <div
      id="request-detail"
      class="tab-pane"
      role="tabpanel"
      aria-labelledby="request-detail-tab"
    >
      <div
        data-bind="template: {name: 'tmpl-request-detail', data: RequestDetailView}"
      ></div>
    </div>
  </div>
</div>
<div id="service-type-templates"></div>

<div id="tmpl-views">
  <script type="text/html" id="tmpl-my-requests-view">
    <h2>My Requests</h2>
    <div class="d-flex">
      <div class="list-group me-3" id="section-my-requests-tabs">
        <button
          class="list-group-item list-group-action"
          id="my-open-requests-tab"
          data-target="open"
          data-bind="click: viewTabClicked, 
            css: {'active': views.open == View()}"
          type="button"
        >
          Open
        </button>
        <button
          class="list-group-item list-group-action"
          id="my-closed-requests-tab"
          data-target="closed"
          data-bind="click: viewTabClicked, 
            css: {'active': views.closed == View()}"
          type="button"
        >
          Closed
        </button>
        <button
          class="list-group-item list-group-action"
          id="my-cancelled-requests-tab"
          data-target="cancelled"
          data-bind="click: viewTabClicked, 
            css: {'active': views.cancelled == View()}"
          type="button"
        >
          Cancelled
        </button>
      </div>
      <div class="container">
        <!-- ko if: ActiveComponent -->
        <div
          data-bind="template: {name: ActiveComponent().TemplateId, data: ActiveComponent()} "
        ></div>
        <!-- /ko -->
      </div>
    </div>
  </script>

  <script type="text/html" id="tmpl-my-open-requests">
    <h2>Hello Open</h2>
  </script>

  <script type="text/html" id="tmpl-my-closed-requests">
    <h2>Hello Closed</h2>
  </script>

  <script type="text/html" id="tmpl-requests-by-status">
    <h2 data-bind="text: filter"></h2>
    <table class="table table-hover">
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
        </tr>
      </thead>
      <tbody data-bind="foreach: FilteredRequests">
        <tr data-bind="click: $root.ViewRequest">
          <td data-bind="text: ID"></td>
          <td data-bind="text: Title"></td>
        </tr>
      </tbody>
    </table>
  </script>

  <script type="text/html" id="tmpl-new-request-view">
    <h2>Select the type of work order you would like to open:</h2>
    <div class="container text-center">
      <div class="row row-cols-4" data-bind="foreach: ServiceTypeStore">
        <div class="col">
          <div class="card text-center" data-bind="click: $root.NewRequest">
            <div class="card-body">
              <i class="fa fa-5x" data-bind="class: Icon"></i>
            </div>
            <div class="card-body">
              <h5 class="card-title" data-bind="text: Title"></h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </script>

  <script type="text/html" id="tmpl-request-detail">
    <!-- Report.RequestDetailView -->
    <div class="container">
      <h2>Service Request Detail</h2>
      <!-- ko if: !$data -->
      <div>Please create a new request, or open an existing request.</div>
      <!-- /ko -->
      <!-- ko if: $data -->
      <div>
        <!-- ko if: PipelineComponent -->
        <div
          class="mb-3"
          data-bind="template: {name: 'tmpl-request-pipeline', data: PipelineComponent}"
        ></div>
        <!-- /ko -->
        <div data-bind="template: {name: 'tmpl-request-header'}"></div>
        <div data-bind="template: {name: 'tmpl-service-type-component'}"></div>
        <div class="row mb-3">
          <div class="col-4">
            <div class="card">
              <div class="card-body">
                <h3 class="card-title">Attachments</h3>
                <!-- ko if: false -->
                <div class="d-flex justify-content-center">
                  <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
                <!-- /ko -->
              </div>
            </div>
          </div>
          <div class="col-8">
            <div class="card">
              <div class="card-body">
                <h3 class="card-title">Approvals and Actions Log</h3>
                <!-- ko if: false -->
                <div class="d-flex justify-content-center">
                  <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
                <!-- /ko -->
              </div>
            </div>
          </div>
        </div>
        <div class="card mb-3 w-100">
          <div class="card-body">
            <h3 class="card-title">Comments</h3>
            <!-- ko if: false -->
            <div class="d-flex justify-content-center">
              <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
            <!-- /ko -->
            <textarea class="form-control"></textarea>
          </div>
        </div>
        <div>
          <!-- ko if: DisplayMode() -->
          <button type="button" data-bind="click: SubmitNewRequest">
            Submit
          </button>
          <!-- /ko -->
          <!-- ko if: DisplayMode() == DisplayModes.View -->
          <button type="button" data-bind="click: EditRequest">Edit</button>
          <!-- /ko -->
          <!-- ko if: DisplayMode() == DisplayModes.Edit -->
          <button type="button" data-bind="click: UpdateRequest">
            Save Changes
          </button>
          <button type="button" data-bind="click: CancelChanges">Cancel</button>
          <!-- /ko -->
        </div>
      </div>
      <!-- /ko -->
    </div>
  </script>

  <script type="text/html" id="tmpl-request-pipeline">
    <div class="row">
      <ol class="list-group-horizontal d-flex" data-bind="foreach: stages">
        <li
          class="list-group-item"
          data-bind="css: {'list-group-item-secondary': Step == $parent.currentStage()}"
        >
          <div class="d-flex align-items-center">
            <h4 class="" data-bind="text: Step"></h4>
            <div class="mx-2"></div>
            <div>
              <div class="fw-bold" data-bind="text: Title"></div>
              <p data-bind="text: ActionType"></p>
            </div>
          </div>
        </li>
      </ol>
    </div>
  </script>

  <script type="text/html" id="tmpl-request-header">
    <!-- Report.RequestDetailView -->
    <div class="card mb-3 w-100">
      <div class="card-body">
        <h3 class="card-title">Requestor Information</h3>
        <!-- ko if: DisplayMode() == DisplayModes.New -->
        <div class="container-fluid">
          <div class="row">
            <div class="col-6 pb-2">
              <h6>Request Status:</h6>
              <p>Draft</p>
            </div>
          </div>
          <div class="row">
            <div class="col-6 pb-2">
              <label
                ><h6>Request ID:</h6>
                <p data-bind="text: ObservableTitle"></p
              ></label>
            </div>
            <div class="col-6 pb-2">
              <div class="form-group">
                <label><h6>Requestor Office:</h6></label>
                <select
                  class="form-control"
                  data-bind="value: RequestorInfo.Office,
                options: $root.currentUser.RequestOrgs,
                optionsText: (ro) => ro.Title"
                ></select>
                <p>
                  GTM:
                  <span
                    data-bind="text: RequestorInfo.Office()?.GTM?.LookupValue"
                  ></span>
                </p>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-6 pb-2">
              <h6>Requestor:</h6>
              <div
                id="people-requestor"
                data-bind="people: RequestorInfo.Requestor"
              ></div>
            </div>
          </div>
          <div class="row">
            <div class="col-6 pb-2">
              <h6>Requestor Phone:</h6>
              <input
                type="tel"
                class="form-control"
                data-bind="value: RequestorInfo.Phone"
              />
            </div>
            <div class="col-6 pb-2">
              <h6>Requestor Email:</h6>
              <input
                type="email"
                class="form-control"
                class="fluid"
                data-bind="value: RequestorInfo.Email"
              />
            </div>
            <div class="col-12 pb-2">
              <h6>Service Type:</h6>
              <select
                class="form-control"
                class="fluid"
                data-bind="value: ServiceType,
              options: $root.Config.serviceTypeStore,
              optionsText: (st) => st.Title"
              ></select>
            </div>
          </div>
        </div>
        <!-- /ko -->
        <!-- ko if: DisplayMode() != DisplayModes.New -->
        <div class="container-fluid" data-bind="">
          <div class="row">
            <div class="col-6">
              <h6>Request Status:</h6>
              <p data-bind="text: State.Status"></p>
            </div>
          </div>
          <div class="row">
            <div class="col-6">
              <h6>Request ID:</h6>
              <p data-bind="text: ObservableTitle"></p>
            </div>
            <div class="col-6">
              <h6>Requestor Office:</h6>
              <p data-bind="text: RequestorInfo.Office()?.Title"></p>
            </div>
          </div>
          <div class="row">
            <div class="col-6">
              <h6>Requestor:</h6>
              <p data-bind="text: RequestorInfo.Requestor()?.Title"></p>
            </div>
          </div>
          <div class="row">
            <div class="col-6">
              <h6>Requestor Phone:</h6>
              <p data-bind="text: RequestorInfo.Phone"></p>
            </div>
            <div class="col-6">
              <h6>Requestor Email:</h6>
              <p data-bind="text: RequestorInfo.Email"></p>
            </div>
            <div class="col-6">
              <h6>Submitted Date:</h6>
              <p data-bind="text: Dates.Submitted()?.toLocaleString()"></p>
            </div>
            <div class="col-6">
              <h6>Service Type:</h6>
              <p data-bind="text: ServiceType()?.Title"></p>
            </div>
          </div>
        </div>
        <!-- /ko -->
      </div>
    </div>
  </script>

  <script type="text/html" id="tmpl-service-type-component">
    <div class="card mb-3 w-100" data-bind="using: ServiceTypeComponent">
      <div class="card-body">
        <div class="card-title d-flex justify-content-between">
          <h3 class="mx-0" data-bind="text: ServiceType()?.Title"></h3>
          <i
            class="fa fa-sync pointer"
            data-bind="click: refreshServiceTypeEntity"
          ></i>
        </div>
        <!-- ko if: ServiceType()?.HasTemplate -->
        <!-- ko if: ComponentsAreLoading -->
        <div class="d-flex justify-content-center">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
        <!-- /ko -->
        <!-- ko if: !ComponentsAreLoading() && ServiceTypeEntity() -->
        <!-- ko if: IsLoading -->
        <div class="d-flex justify-content-center">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
        <!-- /ko -->
        <!-- ko ifnot: IsLoading -->
        <div
          data-bind="template: {name: ElementId, data: ServiceTypeEntity}"
        ></div>
        <!-- /ko -->
        <!-- /ko -->
        <!-- /ko -->
        <div class="col-12 pb-6">
          <label for=""
            ><h6>
              <span
                data-bind="text: ServiceType()?.DescriptionTitle ?? 'Description'"
              ></span
              >:
            </h6>
          </label>
          <!-- ko if: Request.DisplayMode() != Request.DisplayModes.View -->
          <textarea
            class="form-control"
            data-bind="value: Request.RequestDescription"
          ></textarea>
          <!-- /ko -->
          <!-- ko if: Request.DisplayMode() == Request.DisplayModes.View -->
          <div data-bind="html: Request.RequestDescription"></div>
          <!-- /ko -->
        </div>
      </div>
    </div>
  </script>
</div>
<script
  type="text/javascript"
  src="../Apps/_layouts/15/clienttemplates.js"
></script>
<script
  type="text/javascript"
  src="../Apps/_layouts/15/clientforms.js"
></script>
<script
  type="text/javascript"
  src="../Apps/_layouts/15/clientpeoplepicker.js"
></script>
<script type="text/javascript" src="../Apps/_layouts/15/autofill.js"></script>

<script src="../SiteAssets/workorder/vendor/knockout/knockout-3.5.0.js"></script>
<!-- <script src="../SiteAssets/wo/common/KnockoutExtensions.js"></script> -->

<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
  crossorigin="anonymous"
></script>

<script defer type="module" src="../SiteAssets/wo/page_wo_db.js"></script>
